## Proxmox Backup Cloud

En este tutorial, vamos a configurar de manera sencilla el servicio de copias de seguridad en nuestro proveedor de almacenamiento personal en la nube, gdrive, mega, Dropbox, onedrive‚Ä¶ a√±adi√©ndolo como un datastore m√°s, usando rclone en el que guardaremos nuestras copias de seguridad de manera segura y sin hacer uso de ning√∫n script.
##
### Preparaci√≥n:

Nos conectaremos por nuestro cliente ssh preferido o desde Shell del propio proxmox y creamos un directorio nuevo en la carpeta /mnt. Le podemos poner el nombre que queramos que nos ayude a identificarlo, por ejemplo si vamos a usar google drive podemos llamarlo gdrive. Por lo que lo har√≠amos asi:

```
mkdir /mnt/gdrive
```

Ahora vamos a a√±adir ese directorio a nuestro datastore.

Lo haremos asi:

![This is an image](https://github.com/proxmology/manuales/blob/main/Proxmox%20Backup%20Cloud/imagen1.png)



A continuaci√≥n indicamos el nombre gdrive, el directorio que hemos creado y en contenido elegimos Archivo VZDump.

![This is an image](https://github.com/proxmology/manuales/blob/main/Proxmox%20Backup%20Cloud/imagen2.png)


Le damos a Agregar y como vemos nos a√±ade el nuevo directorio a nuestro datastore

![This is an image](https://github.com/proxmology/manuales/blob/main/Proxmox%20Backup%20Cloud/imagen3.png)

##
### Usando rclone para el montaje en nuestra nube:

Aunque el directorio llamado gdrive este en nuestro datastore, evidentemente a√∫n no esta montado en la nube, para ello vamos a usar [rclone](https://rclone.org).

Un detalle a tener en cuenta es que rclone a cambiado la manera en que autoriza el [servicio que vincula a nuestra nube](https://rclone.org/remote_setup/). Para ello tenemos que conectarnos por nuestro cliente ssh y lanzar el siguiente c√≥digo cambiando el usuario por el de proxmox que posiblemente sea root si no lo hemos cambiado y la direcci√≥n ip que corresponda de proxmox:

```
ssh -L localhost:53682:localhost:53682 root@ip_proxmox
```
Ahora instalamos rclone:

```
apt-get update;
```

```
apt-get install rclone;
```

Seguimos los pasos. Podemos hacer uso de la [gu√≠a](https://rclone.org/docs/) de rclone de nuestra nube.

Importante: Cuando lleguemos a este punto diremos si ‚Äúy‚Äù nos dar√° una direcci√≥n tipo localhost que al crear el vinculo con proxmox podremos abrirlo y autorizarnos.
```
Use web browser to automatically authenticate rclone with remote?
 * Say Y if the machine running rclone has a web browser you can use
 * Say N if running rclone on a (remote) machine without web browser access
If not sure try Y. If Y failed, try N.
y) Yes
n) No
y/n> y
```
Una vez tengamos configurado rclone s√≥lo falta montarlo. Podemos crear en nuestra nube personal una carpeta que se llame PBC.

Para montar rclone en proxmox y vincularlo con esa carpeta, lo har√©mos asi:

```
rclone mount gdrive:/PBC /mnt/gdrive --allow-other --allow-non-empty
```
- gdrive:/PBC es la carpeta de nuestra nube.
- /mnt/gdrive es el directiro de proxmox que a√±adimos a nuestro datastore.

##
### Automatizar el montaje de rclone

Si queremos que rclone se inicie en cada arranque de proxmox, podemos usarlo con un crontab para hacerlo, lo hacemos asi:

```
crontab -e
```
A continuaci√≥n nos preguntar√°, en primer lugar, que tipo de editor queremos utilizar para editar el fichero. Yo indico la opci√≥n 1, que es la que corresponde a Nano, ya que es el editor por consola que me parece m√°s simple e intuitivo de utilizar. 
Una vez dentro del editor solo falta a√±adir esta l√≠nea tal y como se muestra en la imagen:

```
@reboot rclone mount gdrive:/PBC /mnt/gdrive --allow-other -‚Äîallow-non-empty
```
![This is an image](https://github.com/proxmology/manuales/blob/main/Proxmox%20Backup%20Cloud/imagen4.png)

Para terminar pulsamos la combinaci√≥n de teclas control + X
Indicamos ‚ÄúY‚Äù + intro y con esto ya tenemos montado rclone en nuestro proxmox con inicio autom√°tico y vinculado a nuestra nube.

Ahora solo nos falta comprobar si hacemos un backup y seleccionamos como disco de destino nuestro gdrive.

![This is an image](https://github.com/proxmology/manuales/blob/main/Proxmox%20Backup%20Cloud/imagen5.png)

Comprobar√©mos como al terminar la copia de seguridad esta estar√° justamente donde quer√≠amos, en nuestra nube.

![This is an image](https://github.com/proxmology/manuales/blob/main/Proxmox%20Backup%20Cloud/imagen6.png)

##
### A tener en cuenta.

las copias de seguridad que hace proxmox a diferencia de proxmox backup server, no son increm√©ntales. Por lo que en funci√≥n del espacio que tengamos en nuestra nube, la cantidad de copias que hagamos y el tama√±o de las mismas, podremos quedarnos sin espacio pronto.
Para evitar eso podemos a√±adir un sistema de purga de copias en funci√≥n de los par√°metros que quer√©mos.
Por ejemplo que nos guarde s√≥lo las 5 ultimas copias como se muestra en la imagen.

![This is an image](https://github.com/proxmology/manuales/blob/main/Proxmox%20Backup%20Cloud/imagen7.png)



#

<div style="display: flex; justify-content: center; align-items: center;">
  <a href="https://ko-fi.com/G2G313ECAN" target="_blank" style="display: flex; align-items: center; text-decoration: none;">
    <img src="https://raw.githubusercontent.com/MacRimi/HWEncoderX/main/images/kofi.png" alt="Support me on Ko-fi" style="width:175px; margin-right:65px;"/>
  </a>
</div>
Si este tutorial te ha gustado y te ha sido √∫til, ¬°puedes invitarme a un Ko-fi! ¬°Gracias! üòä
